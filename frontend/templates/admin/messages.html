{% extends "admin/base.html" %}

{% block title %}Manage Messages{% endblock %}

{% block page_title %}Contact Messages{% endblock %}
{% block page_subtitle %}View and manage messages from your portfolio contact form{% endblock %}

{% block content %}
<div class="glassmorphism rounded-2xl p-6 neon-hover">
    <!-- Messages Header -->
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
        <div>
            <h3 class="text-xl font-bold text-white flex items-center">
                <i class="fas fa-envelope text-cyan-400 mr-3"></i>
                All Messages ({{ messages|length }})
            </h3>
            <p class="text-white/60 mt-1">
                {% set unread_count = messages|selectattr('read', 'equalto', false)|list|length %}
                {{ unread_count }} unread message{{ 's' if unread_count != 1 }}
            </p>
        </div>
        
        <div class="flex space-x-2 mt-4 md:mt-0">
            <a href="{{ url_for('admin.manage_messages') }}?filter=unread" 
               class="px-4 py-2 bg-purple-500 text-white rounded-lg text-sm font-semibold hover:bg-purple-600 transition-colors">
                <i class="fas fa-envelope mr-2"></i>Unread
            </a>
            <a href="{{ url_for('admin.manage_messages') }}?filter=all" 
               class="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-semibold hover:bg-cyan-600 transition-colors">
                <i class="fas fa-list mr-2"></i>All
            </a>
        </div>
    </div>

    {% if messages %}
    <div class="space-y-4">
        {% for message in messages %}
        <div class="p-6 rounded-lg {% if not message.read %}bg-purple-500/10 border border-purple-400/20{% else %}bg-white/5{% endif %} transition-all duration-300">
            <div class="flex flex-col md:flex-row md:items-start justify-between mb-4">
                <div class="flex-1">
                    <div class="flex items-center mb-2">
                        <h4 class="text-white font-semibold text-lg">{{ message.name }}</h4>
                        {% if not message.read %}
                        <span class="ml-3 bg-purple-500 text-white px-2 py-1 rounded text-xs font-bold">
                            <i class="fas fa-circle mr-1"></i>New
                        </span>
                        {% endif %}
                    </div>
                    <div class="flex flex-wrap items-center gap-4 text-sm">
                        <a href="mailto:{{ message.email }}" class="text-cyan-400 hover:text-cyan-300">
                            <i class="fas fa-envelope mr-1"></i>{{ message.email }}
                        </a>
                        {% if message.subject %}
                        <span class="text-white/70">
                            <i class="fas fa-tag mr-1"></i>{{ message.subject }}
                        </span>
                        {% endif %}
                        <span class="text-white/60">
                            <i class="fas fa-clock mr-1"></i>{{ message.created_at.strftime('%b %d, %Y at %I:%M %p') }}
                        </span>
                    </div>
                </div>
                
                <div class="flex items-center space-x-2 mt-4 md:mt-0">
                    {% if not message.read %}
                    <a href="{{ url_for('admin.mark_message_read', id=message.id) }}" 
                       class="p-2 text-green-400 hover:text-green-300 transition-colors"
                       title="Mark as read">
                        <i class="fas fa-check"></i>
                    </a>
                    {% endif %}
                    
                    <a href="{{ url_for('admin.delete_message', id=message.id) }}" 
                       onclick="return confirm('Are you sure you want to delete this message?')"
                       class="p-2 text-red-400 hover:text-red-300 transition-colors"
                       title="Delete message">
                        <i class="fas fa-trash"></i>
                    </a>
                </div>
            </div>
            
            <div class="mt-4 p-4 bg-black/20 rounded-lg">
                <p class="text-white/80 leading-relaxed">{{ message.message }}</p>
            </div>
            
            <div class="mt-4 pt-4 border-t border-white/10 flex items-center justify-between">
                <div class="flex items-center space-x-4 text-sm">
                    <span class="text-white/60">
                        <i class="fas fa-id-badge mr-1"></i>ID: {{ message.id }}
                    </span>
                    {% if message.read %}
                    <span class="text-green-400">
                        <i class="fas fa-check-circle mr-1"></i>Read
                    </span>
                    {% endif %}
                </div>
                
                <a href="mailto:{{ message.email }}?subject=Re: {{ message.subject or 'Your message' }}&body=Hi {{ message.name }},%0D%0A%0D%0A"
                   class="text-cyan-400 hover:text-cyan-300 text-sm font-semibold">
                    <i class="fas fa-reply mr-1"></i>Reply
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="text-center py-12">
        <i class="fas fa-envelope-open text-cyan-400 text-5xl mb-4"></i>
        <h4 class="text-white font-semibold text-xl mb-2">No Messages Yet</h4>
        <p class="text-white/70 max-w-md mx-auto">
            Messages from your portfolio contact form will appear here. 
            Share your portfolio link to start receiving messages!
        </p>
    </div>
    {% endif %}

    <!-- Pagination (if needed in future) -->
    {% if messages|length > 10 %}
    <div class="mt-8 pt-6 border-t border-white/10 flex justify-center">
        <div class="flex space-x-2">
            <button class="px-4 py-2 bg-cyan-400 text-white rounded-lg font-semibold">
                1
            </button>
            <button class="px-4 py-2 bg-white/10 text-white rounded-lg font-semibold hover:bg-white/20">
                2
            </button>
            <button class="px-4 py-2 bg-white/10 text-white rounded-lg font-semibold hover:bg-white/20">
                3
            </button>
        </div>
    </div>
    {% endif %}
</div>

<!-- Quick Stats -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-8">
    <div class="glassmorphism rounded-2xl p-6 text-center neon-hover">
        <div class="w-16 h-16 bg-cyan-400/20 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-envelope text-cyan-400 text-2xl"></i>
        </div>
        <h4 class="text-white font-bold text-2xl mb-1">{{ messages|length }}</h4>
        <p class="text-cyan-400">Total Messages</p>
    </div>
    
    <div class="glassmorphism rounded-2xl p-6 text-center neon-hover">
        <div class="w-16 h-16 bg-purple-400/20 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-envelope-open text-purple-400 text-2xl"></i>
        </div>
        <h4 class="text-white font-bold text-2xl mb-1">{{ messages|selectattr('read', 'equalto', false)|list|length }}</h4>
        <p class="text-purple-400">Unread Messages</p>
    </div>
    
    <div class="glassmorphism rounded-2xl p-6 text-center neon-hover">
        <div class="w-16 h-16 bg-green-400/20 rounded-full flex items-center justify-center mx-auto mb-4">
            <i class="fas fa-check-circle text-green-400 text-2xl"></i>
        </div>
        <h4 class="text-white font-bold text-2xl mb-1">{{ messages|selectattr('read', 'equalto', true)|list|length }}</h4>
        <p class="text-green-400">Read Messages</p>
    </div>
</div>
{% endblock %}
